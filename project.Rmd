---
title: "cherryB"
author: "Mina Mehdinia, Justin Valentine, Michael Wells"
date: "2022-10-18"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rvest)
library(tidyverse)
library(lubridate)
library(dplyr)
library(ggplot2)
#install.packages("devtools")
#devtools::install_github("dtkaplan/statisticalModeling")
#library(devtools)
library(statisticalModeling)
```

```{r}
Wdata <-  read.csv("newdata.csv")
```

```{r}
Wdata$Age <- as.numeric(Wdata$Age )
head(Wdata)
```
```{r}
newdata <- Wdata %>% 
  filter(!is.na(Wdata$Age))
newdata
```


```{r}
glimpse(newdata)
```

```{r}
newdata$Time <- strptime(newdata$Time, "%H:%M:%S")
newdata$Time <- hms::as_hms(newdata$Time)

newdata <- newdata %>% 
  filter(!is.na(newdata$Time))

newdata$Time <- hms(newdata$Time)

```

```{r}
arrange(newdata, Race)
```

```{r}

ct_yrsex <- ct_yrsex[which(ct_yrsex$sex != "NA"), ]

ggplot(ct_yrsex, aes(x = Year, y = n))+
  geom_line(aes(color = factor(sex)))+
  scale_x_discrete(limits = c(1973:2022))+
  guides( color = guide_legend(title = "SEX"))+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+
  ylab("Number of People")+
  labs(title = "Number of People in Each Year")
```
```{r}

ggplot(newdata, aes(x = Race, y = Age))+
  geom_point()+
  scale_x_discrete(limits = c(1974:2022))+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+
  ylab("Age")+
  xlab("Year")
  labs(title = "")
```


```{r}
df_cleantown <- newdata[which(newdata$Hometown != "NR"), ]

df_cleantown$Hometown <- df_cleantown$Hometown %>% strsplit( ", " ) %>% sapply( "[", 2 )
df_cleantown <- df_cleantown %>% 
  filter(!is.na(df_cleantown$Hometown))

df_cleantown
```

```{r}
library(usmap)
states <- data.frame(df_cleantown$Hometown)

plot_usmap(regions = "states", labels = TRUE)+
  labs(title = "U.S. States",
       subtitle = "This is a blank map of the United States.") + 
  theme(panel.background=element_blank()) 
  
```

```{r}
ggplot()+
  geom_polygon(df_cleantown$Hometown)
```





```{r}
data = readr::read_csv("3139946.csv") #Loading the weather data and named it as data
head(data) #seeing the first six rows of the data
```



```{r}
#dates of all the races in consideration
race_dates <- c('1973/04/01', '1974/03/31', '1975/04/06', '1976/04/04', '1977/04/03', '1978/04/02', '1979/04/01', '1980/03/30', '1981/04/05', '1982/04/04', '1983/03/27', '1984/04/01', '1985/03/31', '1986/04/06', '1987/04/05', '1988/03/27', '1989/04/02', '1990/04/01', '1991/03/31', '1992/04/05', '1993/04/04', '1994/04/10', '1995/04/09', '1996/03/31', '1997/04/06', '1998/04/05', '1999/04/11', '2000/04/09', '2001/04/08', '2002/04/07', '2003/04/06', '2004/04/04', '2005/04/03', '2006/04/02', '2007/04/01', '2008/04/06', '2009/04/05', '2010/04/11', '2011/04/03', '2012/04/01', '2013/04/07', '2014/04/06' ,'2015/04/12', '2016/04/03', '2017/04/02', '2018/04/07', '2019/04/07')

race_dates=as.Date(race_dates, "%Y/%m/%d") #convert to data objects
dates = c(1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019) #create vector of year 
dates.df = data.frame(race_dates,dates) #create new data frame with Date and Year
colnames(dates.df) = c('DATE','Race')
```


```{r}
#using right join to add the year of first 10 races to the cherry blossom data frame
data_join_Race = newdata %>% left_join(dates.df, by = "Race")
head(data_join_Race)
```

```{r}
#using right join to add PRCP and TMIN columns from weather data frame to the cherry blossom data frame by the Date.
data_w <- data %>% select(DATE, PRCP, TMIN) %>% 
  right_join(data_join_Race, by = "DATE")
head(data_w)
```


